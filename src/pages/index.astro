---
import Layout from '@/layouts/Layout.astro';
---

<Layout>

	<div>
		<form action="#">
			<input autofocus required type="url" name="video-url" id="video-url" placeholder="La url del vÃ­deo de youtube...">
			<button type="submit" style="view-transition-name: elmnt-search;">ðŸ”Ž</button>
		</form>
	</div>


</Layout>

<style>

	div{
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		width: 100%;
		height: 100%;
	}

	form{
		max-width: 600px;
		width: 100%;
		height: max-content;

		display: flex;
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		
		gap: 5px;
		padding: 5px;

		border-radius: 8px;
		border: 1px solid #a5adad;

		background: #1c1c2e;
		background: linear-gradient(5deg, rgba(28, 28, 46, 1) 0%, rgba(19, 24, 43, 1) 100%);

		& input{
			background: transparent;
			border: 1px solid transparent;
			text-align: center;
			outline: none;
			width: 100%;
		};
		& button{
			background: transparent;
			border: 1px solid transparent;
			padding: 4px;
			margin: 4px;
			border-radius: 8px;
			transition: all 1s;
		};
		& button:hover {
			background: linear-gradient(-45deg, #313b3f, #0f1f38, #082d72, #637070);
			background-size: 400% 400%;
			animation: gradient 2s infinite;
			transform: scale(1.2);
			filter: blur(0.4);
		};
	}

@keyframes gradient {
	0% {
		background-position: 0% 50%;
	}
	50% {
		background-position: 100% 50%;
	}
	100% {
		background-position: 0% 50%;
	}
}


@media (prefers-color-scheme: light){
	form{
		background: #d9d9d9;
		background: linear-gradient(5deg, rgba(217, 217, 217, 1) 0%, rgba(255, 255, 255, 1) 100%);
		& input{
			color: #333;
		}
		& button:hover{
			background: linear-gradient(-45deg, #b4dde7, #93adc2, #79a4c7, #6c89df);
			background-size: 400% 400%;
			animation: gradient 2s infinite;
		}
	}
}


</style>


<script type="module" is:inline>

const form = document.querySelector("form");
const urlInput = form.querySelector("input[id='video-url']");

form.addEventListener("submit", e => {
	e.preventDefault();

	try {
		const uri = new URL(urlInput.value);
		const host = uri.host;
		let vid = "";


		if(host.includes("youtube.com") && uri.searchParams.has("v")){
			vid = uri.searchParams.get("v");
		}else if(host.includes("youtu.be")){
			const formed = uri.pathname.split("/");
			vid = formed[formed.length -1];
		}else if(uri.pathname.includes("shorts/")){
			const formed = uri.pathname.split("/");
			vid = formed[formed.length -1];
		}else{
			throw new Error("La url solicitada no es vÃ¡lida (asegÃºrese que es de youtube)");
		}

		const info = JSON.stringify({
				vid
		});
		
		window.location.href = `/video/${btoa(info)}`;
	} catch (error) {
		console.error(`Error validando la url: ${error}`)
	}
})

</script>